<!-- 学生主页面 -->
<view class="student-main-container">
  <!-- 顶部装饰 -->
  <view class="top-decoration">
    <view class="decoration-circle circle1"></view>
    <view class="decoration-circle circle2"></view>
    <view class="decoration-circle circle3"></view>
  </view>
  
  <!-- 顶部导航栏 -->
  <view class="top-nav">
    <view class="nav-left">
      <view class="logout-btn" bindtap="logout">退出</view>
      <text class="welcome-text">欢迎回来，{{userInfo.name || '同学'}}</text>
    </view>
    <view class="nav-right">
      <view class="avatar" bindtap="goToProfile"></view>
    </view>
  </view>
  
  <!-- 快速操作卡片 -->
  <view class="quick-actions">
    <view class="action-card" bindtap="scanQRCode">
      <view class="card-icon icon-scan"></view>
      <text class="card-title">扫码签到</text>
      <text class="card-desc">扫描二维码进行签到</text>
    </view>
    <view class="action-card" bindtap="viewAttendanceRecords">
      <view class="card-icon icon-records"></view>
      <text class="card-title">签到记录</text>
      <text class="card-desc">查看个人签到历史</text>
    </view>
  </view>
  
  <!-- 当前签到信息（如果有正在进行的签到） -->
  <view class="current-attendance" wx:if="currentAttendance">
    <view class="section-title">
      <text class="title-text">当前签到</text>
    </view>
    <view class="attendance-card">
      <view class="attendance-info">
        <text class="course-name">{{currentAttendance.courseName}}</text>
        <text class="class-info">{{currentAttendance.className}} | {{currentAttendance.date}}</text>
        <text class="attendance-time">签到时间：{{currentAttendance.startTime}} - {{currentAttendance.endTime}}</text>
      </view>
      <view class="attendance-status">
        <text class="status-text">{{currentAttendance.isSigned ? '已签到成功' : '进行中'}}</text>
        <text class="remaining-time" wx:if="{{!currentAttendance.isSigned}}">({{currentAttendance.remainingMinutes}}:{{currentAttendance.remainingSecondsDisplay}})</text>
      </view>
      <button 
        class="sign-btn" 
        bindtap="directSignIn" 
        disabled="{{currentAttendance.isSigned}}"
        style="{{currentAttendance.isSigned ? 'background: #ccc; color: #999;' : ''}}"
      >
        {{currentAttendance.isSigned ? '已签到' : '立即签到'}}
      </button>
      <view class="signed-text" wx:if="{{currentAttendance.isSigned && currentAttendance.signTime}}">
        签到时间：{{currentAttendance.signTime}}
      </view>
    </view>
  </view>
  
  <!-- 最近签到信息 -->
  <view class="recent-attendance">
    <view class="section-title">
      <text class="title-text">最近签到</text>
      <text class="more-text" bindtap="viewAllRecords">查看全部</text>
    </view>
    <view class="attendance-list">
      <block wx:if="recentAttendances.length > 0">
        <view class="attendance-item" wx:for="{{recentAttendances}}" wx:key="id">
          <view class="item-left">
            <text class="course-name">{{item.courseName}}</text>
            <text class="class-info">{{item.className}} | {{item.date}}</text>
          </view>
          <view class="item-right">
            <text class="attendance-status" wx:if="item.isSigned">
              <text class="signed-text">已签到</text>
              <text class="sign-time">{{item.signTime}}</text>
            </text>
            <text class="attendance-status" wx:else>
              <text class="not-signed-text">未签到</text>
            </text>
          </view>
        </view>
      </block>
      <block wx:else>
        <view style="text-align: center; padding: 40rpx 0; color: #999;">
          暂无签到记录
        </view>
      </block>
    </view>
  </view>
  
  <!-- 个人签到统计 -->
  <view class="statistics">
    <view class="section-title">
      <text class="title-text">签到统计</text>
    </view>
    <view class="stats-grid">
      <view class="stat-item">
        <text class="stat-number">{{stats.totalAttendances}}</text>
        <text class="stat-label">总签到次数</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.attendanceRate}}</text>
        <text class="stat-label">出勤率</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.lateCount}}</text>
        <text class="stat-label">迟到次数</text>
      </view>
    </view>
  </view>
  
  <!-- 手势签到弹窗 -->
  <view class="gesture-modal" wx:if="{{showGestureModal}}" catchtap="hideGestureModal">
    <view class="gesture-modal-content" catchtap="stopPropagation">
      <view class="modal-title">自定义手势签到</view>
      <view class="modal-tip">请绘制解锁图案</view>
      <view class="gesture-container-modal">
        <view class="gesture-grid-student gesture-grid-modal" bindtouchstart="onGestureStart" bindtouchmove="onGestureMove" bindtouchend="onGestureEnd">
          <!-- 手势点 -->
          <view wx:for="{{gesturePoints}}" wx:key="index" class="gesture-point-modal {{isPointInPath(item.id) ? 'active' : ''}}" id="{{item.id}}" style="top:{{item.top}}%; left:{{item.left}}%;"></view>
          <!-- 手势路径绘制画布 -->
          <canvas type="2d" id="gesture-canvas-student" class="gesture-canvas-modal"></canvas>
        </view>
      </view>
      <view class="modal-buttons">
        <button class="modal-btn-reset" bindtap="resetGesture">重置</button>
        <button class="modal-btn-confirm" bindtap="confirmGestureSign">确认</button>
      </view>
    </view>
  </view>
</view>